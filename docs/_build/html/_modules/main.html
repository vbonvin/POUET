

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>main &mdash; POUET 0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="POUET 0.2 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> POUET
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">POUET</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>main</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for main</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Launch the application, link POUET functions to the design</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">uic</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">obs</span><span class="o">,</span> <span class="nn">run</span><span class="o">,</span> <span class="nn">util</span><span class="o">,</span> <span class="nn">clouds</span>
<span class="kn">import</span> <span class="nn">meteo</span> <span class="k">as</span> <span class="nn">meteomodule</span>
<span class="kn">import</span> <span class="nn">design</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="k">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="k">import</span> <span class="n">Time</span><span class="p">,</span> <span class="n">TimeDelta</span>
<span class="kn">import</span> <span class="nn">astropy.coordinates.angles</span> <span class="k">as</span> <span class="nn">angles</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">ephem</span>

<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="k">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="k">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="k">import</span> <span class="n">Wedge</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1">#logging.basicConfig(format=&#39;%(asctime)s | %(name)s(%(funcName)s): %(message)s&#39;, level=logging.DEBUG)</span>
<span class="c1">#logger = logging.getLogger(__name__)</span>

<span class="n">COLORWARN</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
<span class="n">COLORLIMIT</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
<span class="n">COLORNOMINAL</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
<span class="n">COLORSUCCESS</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>



<div class="viewcode-block" id="POUET"><a class="viewcode-back" href="../source/pouet.html#main.POUET">[docs]</a><span class="k">class</span> <span class="nc">POUET</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">design</span><span class="o">.</span><span class="n">Ui_POUET</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">POUET</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting up... This can take a minute...&quot;</span><span class="p">)</span>

        <span class="c1"># logger startup...</span>
        <span class="n">logTextBox</span> <span class="o">=</span> <span class="n">MyLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verticalLayoutWidget</span><span class="p">)</span>
        <span class="n">logTextBox</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> | </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(name)s</span><span class="s1">(</span><span class="si">%(funcName)s</span><span class="s1">): </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1">-%Y %H:%M:%S&#39;</span><span class="p">))</span>
        <span class="c1">#logger.addHandler(logTextBox)</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logTextBox</span><span class="p">)</span>
        <span class="c1"># You can control the logging level</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Startup...&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span> <span class="o">=</span> <span class="kc">False</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">name_location</span> <span class="o">=</span> <span class="s1">&#39;LaSilla&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cloudscheck</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_location</span><span class="p">,</span> <span class="n">cloudscheck</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudscheck</span><span class="p">,</span> <span class="n">debugmode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_configTimeNow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_Time2obstime</span><span class="p">()</span>


        <span class="c1"># todo: do we want to load that at startup ?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky</span> <span class="o">=</span> <span class="n">AllSkyView</span><span class="p">(</span><span class="n">location_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_location</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allskyView</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky_redisplay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayer</span> <span class="o">=</span> <span class="n">AllSkyView</span><span class="p">(</span><span class="n">location_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_location</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allskyViewLayer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayerTargets</span> <span class="o">=</span> <span class="n">AllSkyView</span><span class="p">(</span><span class="n">location_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_location</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allskyViewLayerTargets</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool</span> <span class="o">=</span> <span class="n">VisibilityView</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilityView</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool_draw</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">site_display</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weather_display</span><span class="p">()</span>
        
        <span class="c1"># signal and slots init...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadObs</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherDisplayRefresh</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weather_display</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allSkyRefresh</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allsky_refresh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configCloudsShowLayersValue</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allsky_redisplay</span><span class="p">)</span>
        <span class="c1">#self.checkObsStatus.clicked.connect(self.check_obs_status)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configAutoupdateFreqValue</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_timer_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configTimenow</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_configTimeNow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configUpdate</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">do_update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilityDraw</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool_draw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configDebugModeValue</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_debug_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePlotObs</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listObs_plot_targets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateSelectall</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listObs_selectall</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_visibilitytoolmotion</span><span class="p">)</span>

        <span class="c1"># Stating timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">120000</span><span class="p">)</span> <span class="c1">#trigger every 2 minutes by default.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span><span class="p">)</span>
        
        <span class="c1"># Some housekeeping stuff...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayerTargets</span><span class="o">.</span><span class="n">show_coordinates</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs_check_state</span> <span class="o">=</span> <span class="mi">0</span>
        
        
        <span class="c1"># testing stuff at startup...</span>

        <span class="c1">#self.load_obs(filepath=&#39;2m2lenses_withobsprogram.pouet&#39;)</span>

        

<div class="viewcode-block" id="POUET.on_visibilitytoolmotion"><a class="viewcode-back" href="../source/pouet.html#main.POUET.on_visibilitytoolmotion">[docs]</a>    <span class="k">def</span> <span class="nf">on_visibilitytoolmotion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool</span><span class="o">.</span><span class="n">axis</span><span class="p">:</span> <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">):</span>
            <span class="c1">#logging.debug(&quot;Not showing coordinates on All Sky, delta time too large&quot;)</span>
            <span class="k">return</span>
        
        <span class="n">ra</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
        <span class="n">azimuth</span><span class="p">,</span> <span class="n">altitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_AzAlt</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">obs_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">xpix</span><span class="p">,</span> <span class="n">ypix</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_image_coordinates</span><span class="p">(</span><span class="n">azimuth</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">altitude</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayer</span><span class="o">.</span><span class="n">show_coordinates</span><span class="p">(</span><span class="n">xpix</span><span class="p">,</span> <span class="n">ypix</span><span class="p">)</span></div>

<div class="viewcode-block" id="POUET.print_status"><a class="viewcode-back" href="../source/pouet.html#main.POUET.print_status">[docs]</a>    <span class="k">def</span> <span class="nf">print_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">COLORNOMINAL</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;color: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colour</span><span class="p">))</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="POUET.set_timer_interval"><a class="viewcode-back" href="../source/pouet.html#main.POUET.set_timer_interval">[docs]</a>    <span class="k">def</span> <span class="nf">set_timer_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configAutoupdateFreqValue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Set auto-refresh to </span><span class="si">{}</span><span class="s2"> min&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configAutoupdateFreqValue</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span></div>
        
<div class="viewcode-block" id="POUET.set_configTimeNow"><a class="viewcode-back" href="../source/pouet.html#main.POUET.set_configTimeNow">[docs]</a>    <span class="k">def</span> <span class="nf">set_configTimeNow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1">#get current date and time</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QDateTime</span><span class="o">.</span><span class="n">currentDateTimeUtc</span><span class="p">()</span>

        <span class="c1">#set current date and time to the object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configTime</span><span class="o">.</span><span class="n">setDateTime</span><span class="p">(</span><span class="n">now</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="POUET.save_Time2obstime"><a class="viewcode-back" href="../source/pouet.html#main.POUET.save_Time2obstime">[docs]</a>    <span class="k">def</span> <span class="nf">save_Time2obstime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configTime</span><span class="o">.</span><span class="n">dateTime</span><span class="p">()</span><span class="o">.</span><span class="n">toPyDateTime</span><span class="p">(),</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;utc&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;obs_time is now set to </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span><span class="p">)))</span></div>
        
<div class="viewcode-block" id="POUET.set_debug_mode"><a class="viewcode-back" href="../source/pouet.html#main.POUET.set_debug_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_debug_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configDebugModeValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">goto_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goto_mode</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">goto_mode</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">goto_mode</span><span class="p">:</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;production&quot;</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Changing to </span><span class="si">{}</span><span class="s2"> mode...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="n">colour</span><span class="o">=</span><span class="n">COLORWARN</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span> <span class="o">=</span> <span class="n">goto_mode</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name_location</span><span class="p">,</span> <span class="n">cloudscheck</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudscheck</span><span class="p">,</span> <span class="n">debugmode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auto_refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_update</span><span class="p">()</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Now in </span><span class="si">{}</span><span class="s2"> mode for the All Sky!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Change of mode complete.&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="POUET.do_update"><a class="viewcode-back" href="../source/pouet.html#main.POUET.do_update">[docs]</a>    <span class="k">def</span> <span class="nf">do_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_Time2obstime</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_display</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool_draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_obs</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs_plot_targets</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;General update performed&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="POUET.get_weather_items"><a class="viewcode-back" href="../source/pouet.html#main.POUET.get_weather_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_weather_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>

        <span class="n">moondist</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="n">moondist</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">angletomoon</span><span class="o">.</span><span class="n">degree</span><span class="p">)),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_moondist</span><span class="p">:</span>
            <span class="n">moondist</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">moondist</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>

        <span class="n">airmass</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="n">airmass</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">o</span><span class="o">.</span><span class="n">airmass</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_airmass</span><span class="p">:</span>
            <span class="n">airmass</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">darkGreen</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_highairmass</span><span class="p">:</span>
                <span class="n">airmass</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">darkYellow</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">airmass</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">darkRed</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>

        <span class="n">wind</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>
        <span class="n">wind</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">o</span><span class="o">.</span><span class="n">angletowind</span><span class="o">.</span><span class="n">degree</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_airmass</span><span class="p">:</span>
            <span class="n">wind</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wind</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>

        <span class="n">clouds</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_clouds_info</span><span class="p">:</span>
            <span class="n">clouds</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">cloudfree</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">obs_clouds</span><span class="p">:</span>
                <span class="n">clouds</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">green</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clouds</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clouds</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>
            <span class="n">clouds</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">yellow</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">moondist</span><span class="p">,</span> <span class="n">airmass</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">clouds</span></div>



<div class="viewcode-block" id="POUET.load_obs"><a class="viewcode-back" href="../source/pouet.html#main.POUET.load_obs">[docs]</a>    <span class="k">def</span> <span class="nf">load_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">logmsg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItemModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="p">)</span>

        <span class="c1"># we start from scratch</span>
        <span class="c1"># todo: add an update function to load many obs one after the other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">clearSpans</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select a file&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">logmsg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">filepath</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;.pouet&#39;</span><span class="p">:</span>  <span class="c1"># then it&#39;s a first load:</span>

            <span class="n">obsprogramlist</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">retrieve_obsprogramlist</span><span class="p">()</span>
            <span class="n">obsprogramnames</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obsprogramlist</span><span class="p">)</span>

            <span class="c1"># header popup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUi</span><span class="p">(</span><span class="s2">&quot;headerdialog.ui&quot;</span><span class="p">)</span>

            <span class="c1"># split by tabs/spaces</span>
            <span class="n">headers_input</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerNameValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerRAValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerDecValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers_input</span><span class="p">:</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">))</span>

            <span class="c1"># ok is 0 if rejected, 1 if accepted</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>

                <span class="n">namecol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerNameValue</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">alphacol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerRAValue</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">deltacol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerDecValue</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                    <span class="n">obsprogramcol</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obsprogramcol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headerPopup</span><span class="o">.</span><span class="n">headerObsprogramValue</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>

                <span class="c1"># obsprogram popup</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">popup</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QInputDialog</span><span class="p">()</span>
                <span class="c1">#todo rename Cancel button as default if possible</span>
                <span class="n">obsprogram</span><span class="p">,</span> <span class="n">okop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popup</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Select an observing program&quot;</span><span class="p">,</span> <span class="s2">&quot; - Existing programs -</span><span class="se">\n</span><span class="s2">Select Cancel to use the default configuration.</span><span class="se">\n</span><span class="s2">This setting applies only to the observables</span><span class="se">\n</span><span class="s2">that do not already have an obsprogram defined in the input file&quot;</span><span class="p">,</span> <span class="n">obsprogramnames</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">okop</span><span class="p">:</span>
                    <span class="n">logmsg</span> <span class="o">+=</span> <span class="s1">&#39;as </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">obsprogram</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obsprogram</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">logmsg</span> <span class="o">+=</span> <span class="s1">&#39;as default &#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># we exit the load function</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Load of % aborted by user&quot;</span> <span class="o">%</span> <span class="n">filepath</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># then it&#39;s a pouet file. We assume it follows our own convention for the rdbimport</span>
            <span class="c1"># col#1 = name, col#2 = alpha, col#3 = dec, col#4 = obsprogram</span>
            <span class="k">pass</span>


        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1">#todo: replace that by a try/except when the loader is fully debugged...</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;.pouet&#39;</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">rdbimport</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">obsprogram</span><span class="o">=</span><span class="n">obsprogram</span><span class="p">,</span> <span class="n">namecol</span><span class="o">=</span><span class="n">namecol</span><span class="p">,</span> <span class="n">alphacol</span><span class="o">=</span><span class="n">alphacol</span><span class="p">,</span> <span class="n">deltacol</span><span class="o">=</span><span class="n">deltacol</span><span class="p">,</span> <span class="n">obsprogramcol</span><span class="o">=</span><span class="n">obsprogramcol</span><span class="p">)</span>

                <span class="c1"># check that names are unique</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">]</span>
                    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Names in your catalog are not unique!&quot;</span><span class="p">)</span>
                    <span class="k">return</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">observables</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">rdbimport</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">obsprogram</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">run</span><span class="o">.</span><span class="n">refresh_status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;entering compute observability&quot;</span><span class="p">)</span>
                <span class="n">o</span><span class="o">.</span><span class="n">compute_observability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="n">cloudscheck</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">name</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
                <span class="n">observability</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">observability</span><span class="p">))</span>

                <span class="n">moondist</span><span class="p">,</span> <span class="n">airmass</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">clouds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weather_items</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

                <span class="n">obsprogram</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">obsprogram</span><span class="p">)</span>

                <span class="n">name</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">appendRow</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">observability</span><span class="p">,</span> <span class="n">obsprogram</span><span class="p">,</span> <span class="n">moondist</span><span class="p">,</span> <span class="n">airmass</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">clouds</span><span class="p">])</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Delta&#39;</span><span class="p">,</span> <span class="s1">&#39;Observability&#39;</span><span class="p">,</span> <span class="s1">&#39;Program&#39;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">])</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;exiting model update&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

            <span class="n">logmsg</span> <span class="o">+=</span> <span class="s1">&#39;successfully loaded&#39;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">logmsg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Sucessfully loaded&quot;</span> <span class="o">%</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">COLORSUCCESS</span><span class="p">)</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">logmsg</span> <span class="o">+=</span> <span class="s1">&#39; not loaded - format unknown&#39;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logmsg</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Format unknown&quot;</span> <span class="o">%</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">COLORWARN</span><span class="p">)</span></div>


<div class="viewcode-block" id="POUET.update_obs"><a class="viewcode-back" href="../source/pouet.html#main.POUET.update_obs">[docs]</a>    <span class="k">def</span> <span class="nf">update_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the observability of the observables, and update the display model</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># refresh the observables&#39; constraints</span>
        <span class="n">run</span><span class="o">.</span><span class="n">refresh_status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">)</span>

        <span class="c1"># load the display model and the current header</span>
        <span class="n">obs_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">go_on</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">go_on</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">obs_model</span><span class="o">.</span><span class="n">horizontalHeaderItem</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># will return None if there&#39;s no header...</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">go_on</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">observability_index</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Observability&quot;</span><span class="p">)</span>
        <span class="n">moondist_index</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
        <span class="n">airmass_index</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">wind_index</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)</span>
        <span class="n">clouds_index</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>


        <span class="c1"># we use the obs name as a reference to update the model</span>
        <span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">))]</span>

        <span class="c1"># compute observability and refresh the model</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">):</span>
            <span class="n">o</span><span class="o">.</span><span class="n">compute_observability</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="n">cloudscheck</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">moondist</span><span class="p">,</span> <span class="n">airmass</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">clouds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weather_items</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

            <span class="c1"># make sur we update the correct observable in the model...</span>
            <span class="n">obs_index</span> <span class="o">=</span> <span class="n">model_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">obs_index</span><span class="p">,</span> <span class="n">observability_index</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStandardItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">observability</span><span class="p">)))</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">obs_index</span><span class="p">,</span> <span class="n">moondist_index</span><span class="p">,</span> <span class="n">moondist</span><span class="p">)</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">obs_index</span><span class="p">,</span> <span class="n">airmass_index</span><span class="p">,</span> <span class="n">airmass</span><span class="p">)</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">obs_index</span><span class="p">,</span> <span class="n">wind_index</span><span class="p">,</span> <span class="n">wind</span><span class="p">)</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">obs_index</span><span class="p">,</span> <span class="n">clouds_index</span><span class="p">,</span> <span class="n">clouds</span><span class="p">)</span>


        <span class="c1"># refresh the display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">obs_model</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Observability refreshed&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">COLORSUCCESS</span><span class="p">)</span></div>


<div class="viewcode-block" id="POUET.check_obs_status"><a class="viewcode-back" href="../source/pouet.html#main.POUET.check_obs_status">[docs]</a>    <span class="k">def</span> <span class="nf">check_obs_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: states of observables</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#0 is not checked, 1 is partially checked, 2 is checked --&gt; 0 or 2 for us</span>
        <span class="n">obs_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>

        <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">obs_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">obs_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())]</span>

        <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">states</span><span class="p">,</span> <span class="n">names</span></div>


<div class="viewcode-block" id="POUET.hide_observables"><a class="viewcode-back" href="../source/pouet.html#main.POUET.hide_observables">[docs]</a>    <span class="k">def</span> <span class="nf">hide_observables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criterion</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide observables according to a given criterion</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_obs_status</span><span class="p">()</span></div>




<div class="viewcode-block" id="POUET.unhide_observables"><a class="viewcode-back" href="../source/pouet.html#main.POUET.unhide_observables">[docs]</a>    <span class="k">def</span> <span class="nf">unhide_observables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="POUET.listObs_selectall"><a class="viewcode-back" href="../source/pouet.html#main.POUET.listObs_selectall">[docs]</a>    <span class="k">def</span> <span class="nf">listObs_selectall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">obs_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs_check_state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out_state</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_state</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">obs_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">obs_model</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">out_state</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs_check_state</span> <span class="o">=</span> <span class="n">out_state</span></div>
    
<div class="viewcode-block" id="POUET.listObs_plot_targets"><a class="viewcode-back" href="../source/pouet.html#main.POUET.listObs_plot_targets">[docs]</a>    <span class="k">def</span> <span class="nf">listObs_plot_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">obs_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listObs</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">obs_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Nothing to plot: no obs loaded&quot;</span><span class="p">)</span>
            <span class="k">return</span> 
            
        <span class="n">status</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_obs_status</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">alphas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deltas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">are_obs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">as_xs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">as_ys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ord_names</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observables</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">ord_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            
            <span class="n">az</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_AzAlt</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">as_x</span><span class="p">,</span> <span class="n">as_y</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_image_coordinates</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">elev</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            
            <span class="n">alphas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">alpha</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">as_xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_x</span><span class="p">)</span>
            <span class="n">as_ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_y</span><span class="p">)</span>
            <span class="n">are_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">observability</span><span class="p">)</span>
            
        <span class="c1">#-------- Plots on visibility layer</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool_draw_exec</span><span class="p">()</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configShowTargetsVisibilityValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># This is not the most perfect code ever, however if drawing on another layer, it&#39;s hard to read the coordinates of the mouse in the plot</span>
            <span class="c1"># for the show_coordinate in all_sky, so by passing.</span>
            <span class="c1"># (however visibilitytool_draw_exec is fast...)</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool</span><span class="o">.</span><span class="n">show_targets</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">deltas</span><span class="p">,</span> <span class="n">ord_names</span><span class="p">,</span> <span class="n">meteo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">)</span>
        
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotted </span><span class="si">{}</span><span class="s2"> targets in visibility&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
        
        <span class="c1">#-------- Plots on all sky layer</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayerTargets</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configShowTargetsAllSkyValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allsky_debugmode</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not showing targets on All Sky, delta time too large&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">allskylayerTargets</span><span class="o">.</span><span class="n">show_targets</span><span class="p">(</span><span class="n">as_xs</span><span class="p">,</span> <span class="n">as_ys</span><span class="p">,</span> <span class="n">ord_names</span><span class="p">)</span>
            
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotted </span><span class="si">{}</span><span class="s2"> targets in All Sky&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span></div>


<div class="viewcode-block" id="POUET.weather_display"><a class="viewcode-back" href="../source/pouet.html#main.POUET.weather_display">[docs]</a>    <span class="k">def</span> <span class="nf">weather_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Last weather report was downloaded more recently than 30 seconds ago, I don&#39;t download it again&quot;</span><span class="p">)</span>
            <span class="n">draw_wind</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">updateweather</span><span class="p">()</span>
            <span class="n">draw_wind</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherWindSpeedValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">windspeed</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windLimitLevel&quot;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">windspeed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherWindSpeedValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORLIMIT</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windWarnLevel&quot;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">windspeed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherWindSpeedValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORWARN</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherWindSpeedValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORNOMINAL</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherWindDirectionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:3d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">winddirection</span><span class="p">))))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherTemperatureValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">temperature</span><span class="p">))))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherHumidityValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:3d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">humidity</span><span class="p">))))</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;humidityLimitLevel&quot;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">humidity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherHumidityValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORLIMIT</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;humidityWarnLevel&quot;</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">humidity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherHumidityValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORWARN</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherHumidityValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORNOMINAL</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">draw_wind</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allsky_redisplay</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">weatherLastUpdateValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="POUET.site_display"><a class="viewcode-back" href="../source/pouet.html#main.POUET.site_display">[docs]</a>    <span class="k">def</span> <span class="nf">site_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">siteLocationValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;Lat=</span><span class="si">{:s}</span><span class="se">\t</span><span class="s1">Lon=</span><span class="si">{:s}</span><span class="se">\t</span><span class="s1">Elev=</span><span class="si">{:s}</span><span class="s1"> m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;elevation&quot;</span><span class="p">))))</span>
        
        <span class="n">obs_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span>
        
        <span class="c1">#-------------------------------------------------------- Bright objects now</span>
        
        <span class="n">sunAz</span><span class="p">,</span> <span class="n">sunAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_sun</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span>
        <span class="n">sunAlt</span> <span class="o">=</span> <span class="n">sunAlt</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">sunAz</span> <span class="o">=</span> <span class="n">sunAz</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sunCoordinatesValues</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;RA=</span><span class="si">{:s}</span><span class="s1">  DEC=</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sunAltazValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.1f}</span><span class="s1"></span><span class="se">\t</span><span class="si">{:2.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sunAlt</span><span class="p">,</span> <span class="n">sunAz</span><span class="p">)))</span>
        
        <span class="n">moonAz</span><span class="p">,</span> <span class="n">moonAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_moon</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span>
        <span class="n">moonAlt</span> <span class="o">=</span> <span class="n">moonAlt</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">moonAz</span> <span class="o">=</span> <span class="n">moonAz</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">moonCoordinatesValues</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;RA=</span><span class="si">{:s}</span><span class="s1">  DEC=</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">moon</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">moon</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moonAltazValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.1f}</span><span class="s1"></span><span class="se">\t</span><span class="si">{:2.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moonAlt</span><span class="p">,</span> <span class="n">moonAz</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">brightLastUpdateValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1">#-------------------------------------------------------- Night here only (we change the obs_time so this must the last things to run!)</span>
        
        <span class="n">cobs_time</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span>
        <span class="c1">#cobs_time = Time(&#39;2018-02-08 01:00:00&#39;, format=&#39;iso&#39;, scale=&#39;utc&#39;)</span>
        <span class="n">cobs_time</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;iso&#39;</span>
        <span class="n">cobs_time</span><span class="o">.</span><span class="n">out_subfmt</span> <span class="o">=</span> <span class="s1">&#39;date&#39;</span>
        
        <span class="n">ref_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> 12:00:00&#39;</span> <span class="o">%</span> <span class="n">cobs_time</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;iso&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span> <span class="c1">#5h UT is approx. the middle of the night</span>
        
        <span class="n">is_after_midday</span> <span class="o">=</span> <span class="p">(</span><span class="n">cobs_time</span><span class="o">-</span><span class="n">ref_time</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">is_after_midday</span><span class="p">:</span>
            <span class="n">day_before</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cobs_time</span><span class="p">)</span>
            <span class="n">night_date</span> <span class="o">=</span> <span class="n">cobs_time</span>
            <span class="n">day_after</span> <span class="o">=</span> <span class="n">night_date</span> <span class="o">+</span> <span class="n">TimeDelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">day_after</span> <span class="o">=</span> <span class="n">cobs_time</span>
            <span class="n">night_date</span> <span class="o">=</span> <span class="n">cobs_time</span> <span class="o">-</span> <span class="n">TimeDelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">)</span>
            <span class="n">day_before</span> <span class="o">=</span> <span class="n">cobs_time</span> <span class="o">-</span> <span class="n">TimeDelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">)</span>
            
        <span class="n">sunrise</span><span class="p">,</span> <span class="n">sunset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_twilights</span><span class="p">(</span><span class="n">night_date</span><span class="p">,</span> <span class="n">twilight</span><span class="o">=</span><span class="s1">&#39;civil&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightStartCivilValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunset</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightEndCivilValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunrise</span><span class="p">))))</span>
        
        <span class="n">sunrise</span><span class="p">,</span> <span class="n">sunset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_twilights</span><span class="p">(</span><span class="n">night_date</span><span class="p">,</span> <span class="n">twilight</span><span class="o">=</span><span class="s1">&#39;nautical&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightStartNauticalValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunset</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightEndNauticalValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunrise</span><span class="p">))))</span>
        
        <span class="n">sunrise</span><span class="p">,</span> <span class="n">sunset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">get_twilights</span><span class="p">(</span><span class="n">night_date</span><span class="p">,</span> <span class="n">twilight</span><span class="o">=</span><span class="s1">&#39;astronomical&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightStartAstroValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunset</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightEndAstroValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sunrise</span><span class="p">))))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nightLastUpdateValueBefore</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">day_before</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nightLastUpdateValueAfter</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">day_after</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="POUET.allsky_refresh"><a class="viewcode-back" href="../source/pouet.html#main.POUET.allsky_refresh">[docs]</a>    <span class="k">def</span> <span class="nf">allsky_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Refreshing All Sky...&quot;</span><span class="p">,</span> <span class="n">COLORWARN</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allskylayer</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updated All Sky&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky_redisplay</span><span class="p">()</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;All Sky refresh done.&quot;</span><span class="p">,</span> <span class="n">COLORNOMINAL</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="POUET.allsky_redisplay"><a class="viewcode-back" href="../source/pouet.html#main.POUET.allsky_redisplay">[docs]</a>    <span class="k">def</span> <span class="nf">allsky_redisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configCloudsShowLayersValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plot_analysis</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_analysis</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="n">plot_analysis</span><span class="o">=</span><span class="n">plot_analysis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">display_wind_limits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateWindValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Wind update: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Drawn All Sky.&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="POUET.visibilitytool_draw_exec"><a class="viewcode-back" href="../source/pouet.html#main.POUET.visibilitytool_draw_exec">[docs]</a>    <span class="k">def</span> <span class="nf">visibilitytool_draw_exec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">airmass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilityAirmassValue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">anglemoon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibilityMoonAngleValue</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">check_wind</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Visibility is not considering the wind, too much difference between date weather report and obs time&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_wind</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool</span><span class="o">.</span><span class="n">visbility_draw</span><span class="p">(</span><span class="n">obs_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">meteo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="p">,</span> <span class="n">airmass</span><span class="o">=</span><span class="n">airmass</span><span class="p">,</span> <span class="n">anglemoon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">anglemoon</span><span class="p">),</span> <span class="n">check_wind</span><span class="o">=</span><span class="n">check_wind</span><span class="p">)</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Drawn visibility with airmass=</span><span class="si">{:1.1f}</span><span class="s2">, anglemoon=</span><span class="si">{:d}</span><span class="s2">d&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">airmass</span><span class="p">,</span> <span class="n">anglemoon</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="POUET.visibilitytool_draw"><a class="viewcode-back" href="../source/pouet.html#main.POUET.visibilitytool_draw">[docs]</a>    <span class="k">def</span> <span class="nf">visibilitytool_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">visibilitytool_draw_exec</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listObs_plot_targets</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="POUET.auto_refresh"><a class="viewcode-back" href="../source/pouet.html#main.POUET.auto_refresh">[docs]</a>    <span class="k">def</span> <span class="nf">auto_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Auto-refresh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Auto-refresh started...&quot;</span><span class="p">,</span> <span class="n">COLORWARN</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configCloudsAutoRefreshValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allsky_refresh</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configWindAutoRefreshValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weather_display</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configWindAutoRefreshValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">configCloudsAutoRefreshValue</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allsky_redisplay</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">lastest_weatherupdate_time</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateWindValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORWARN</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherLastUpdateValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORWARN</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateWindValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORNOMINAL</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weatherLastUpdateValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORNOMINAL</span><span class="p">))</span>
            
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentmeteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORWARN</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allSkyUpdateValue</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QLabel { color : </span><span class="si">%s</span><span class="s2">; }&quot;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">(</span><span class="n">COLORNOMINAL</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">print_status</span><span class="p">(</span><span class="s2">&quot;Auto-refresh done.&quot;</span><span class="p">,</span> <span class="n">COLORNOMINAL</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MyLogger"><a class="viewcode-back" href="../source/pouet.html#main.MyLogger">[docs]</a><span class="k">class</span> <span class="nc">MyLogger</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskyWidget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QPlainTextEdit</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskyWidget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskyWidget</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="MyLogger.emit"><a class="viewcode-back" href="../source/pouet.html#main.MyLogger.emit">[docs]</a>    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allskyWidget</span><span class="o">.</span><span class="n">appendPlainText</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AllSkyView"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView">[docs]</a><span class="k">class</span> <span class="nc">AllSkyView</span><span class="p">(</span><span class="n">FigureCanvas</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location_name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">4.66</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">3.5</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="c1">#self.figure.patch.set_facecolor((0.95, 0.94, 0.94, 1.))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
        
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;background-color:transparent;&quot;</span><span class="p">)</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                                   <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="n">img_params</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">location_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imx</span> <span class="o">=</span> <span class="n">img_params</span><span class="p">[</span><span class="s1">&#39;image_x_size&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imy</span> <span class="o">=</span> <span class="n">img_params</span><span class="p">[</span><span class="s1">&#39;image_y_size&#39;</span><span class="p">]</span>
        
<div class="viewcode-block" id="AllSkyView.erase"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView.erase">[docs]</a>    <span class="k">def</span> <span class="nf">erase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">imy</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">imx</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">imy</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imx</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="AllSkyView.show_coordinates"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView.show_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">show_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="AllSkyView.show_targets"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView.show_targets">[docs]</a>    <span class="k">def</span> <span class="nf">show_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
            
            

<div class="viewcode-block" id="AllSkyView.display"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meteo</span><span class="p">,</span> <span class="n">plot_analysis</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">name</span>
        <span class="n">allsky</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">allsky</span>

        <span class="k">if</span> <span class="n">meteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">meteo</span><span class="o">.</span><span class="n">allsky</span><span class="o">.</span><span class="n">last_im_refresh</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">COLORNOMINAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">COLORNOMINAL</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;No connection to All Sky Server&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">COLORNOMINAL</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No All Sky image, by-passing&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">rest</span> <span class="o">=</span> <span class="n">allsky</span><span class="o">.</span><span class="n">im_masked</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_analysis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">im_original</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">rest</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">rest</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">observability_map</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RdYlGn&#39;</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># self.draw()</span>

        <span class="n">theta_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

        <span class="n">ff</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ff&#39;</span><span class="p">]</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;k1&#39;</span><span class="p">]</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;k2&#39;</span><span class="p">]</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">]</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cy&#39;</span><span class="p">]</span>
        <span class="n">north</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>
        <span class="n">deltatetha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;deltatetha&#39;</span><span class="p">]</span>

        <span class="n">coordinatesx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">north</span> <span class="o">+</span> <span class="n">theta_coordinates</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">cx</span>
        <span class="n">coordinatesy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">north</span> <span class="o">+</span> <span class="n">theta_coordinates</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">cy</span>

        <span class="n">northx</span><span class="p">,</span> <span class="n">northy</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_image_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span> <span class="n">location</span><span class="p">)</span>
        <span class="n">eastx</span><span class="p">,</span> <span class="n">easty</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_image_coordinates</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">90</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">location</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">northx</span><span class="p">,</span> <span class="n">northy</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">deltatetha</span><span class="p">,</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">eastx</span><span class="p">,</span> <span class="n">easty</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">deltatetha</span><span class="p">,</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="n">altshow</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">altshow</span><span class="p">):</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_radius</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span>

            <span class="c1"># if angle &gt;= np.pi/2: print rr/330.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="n">rr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>

            <span class="n">textx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">north</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">rr</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cx</span>
            <span class="n">texty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">north</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">rr</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">angle</span><span class="p">))),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">textx</span><span class="p">,</span> <span class="n">texty</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">deltatetha</span><span class="p">,</span>
                               <span class="c1"># prefered_direction[&#39;dir&#39;],</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># plt.plot([cx, northx], [cy, northy], lw=2, color=&#39;k&#39;)</span>
        <span class="k">for</span> <span class="n">ccx</span><span class="p">,</span> <span class="n">ccy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coordinatesx</span><span class="p">,</span> <span class="n">coordinatesy</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">ccx</span><span class="p">],</span> <span class="p">[</span><span class="n">cy</span><span class="p">,</span> <span class="n">ccy</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">rest</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">rest</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="AllSkyView.display_wind_limits"><a class="viewcode-back" href="../source/pouet.html#main.AllSkyView.display_wind_limits">[docs]</a>    <span class="k">def</span> <span class="nf">display_wind_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meteo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Should this call some other function elsewhere? Maybe</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">clouds</span><span class="o">.</span><span class="n">get_params</span><span class="p">(</span><span class="n">meteo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">r0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;r0&#39;</span><span class="p">]</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">]</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cy&#39;</span><span class="p">]</span>
        <span class="n">north</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">]</span>

        <span class="n">wpl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windWarnLevel&quot;</span><span class="p">))</span>
        <span class="n">wsl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windLimitLevel&quot;</span><span class="p">))</span>
        <span class="n">WD</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">winddirection</span>
        <span class="n">WS</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">windspeed</span>
        <span class="n">WDd</span> <span class="o">=</span> <span class="n">WD</span>
        <span class="n">WD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">WD</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">WS</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">WS</span> <span class="o">&gt;</span> <span class="n">wpl</span><span class="p">:</span>
            <span class="n">wdcoordinatesx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">north</span> <span class="o">-</span> <span class="n">WD</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">cx</span>
            <span class="n">wdcoordinatesy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">north</span> <span class="o">-</span> <span class="n">WD</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">cy</span>
            <span class="n">Nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">north</span><span class="p">)</span>  <span class="c1"># + 90.</span>

            <span class="k">if</span> <span class="n">WS</span> <span class="o">&gt;</span> <span class="n">wsl</span><span class="p">:</span>
                <span class="n">cw</span> <span class="o">=</span> <span class="n">COLORLIMIT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Wedge</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">],</span> <span class="n">r0</span><span class="p">,</span> <span class="n">Nd</span> <span class="o">-</span> <span class="n">WDd</span><span class="p">,</span> <span class="n">Nd</span> <span class="o">-</span> <span class="n">WDd</span> <span class="o">+</span> <span class="mi">360</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">cw</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;WIND LIMIT</span><span class="se">\n</span><span class="s1">REACHED&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cw</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">WS</span> <span class="o">&gt;</span> <span class="n">wpl</span><span class="p">:</span>
                <span class="n">cw</span> <span class="o">=</span> <span class="n">COLORWARN</span>
                <span class="n">wtcoordinatesx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">north</span> <span class="o">-</span> <span class="n">WD</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">cx</span>
                <span class="n">wtcoordinatesy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">north</span> <span class="o">-</span> <span class="n">WD</span><span class="p">)</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">cy</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                    <span class="n">Wedge</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">],</span> <span class="n">r0</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">Nd</span> <span class="o">-</span> <span class="n">WDd</span><span class="p">,</span> <span class="mi">90</span> <span class="o">+</span> <span class="n">Nd</span> <span class="o">-</span> <span class="n">WDd</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">cw</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Pointing limit!&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">wtcoordinatesx</span><span class="p">,</span> <span class="n">wtcoordinatesy</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cw</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">cx</span><span class="p">,</span> <span class="n">wdcoordinatesx</span><span class="p">],</span> <span class="p">[</span><span class="n">cy</span><span class="p">,</span> <span class="n">wdcoordinatesy</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cw</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="VisibilityView"><a class="viewcode-back" href="../source/pouet.html#main.VisibilityView">[docs]</a><span class="k">class</span> <span class="nc">VisibilityView</span><span class="p">(</span><span class="n">FigureCanvas</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.23</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.13</span><span class="p">)</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
        
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;background-color:transparent;&quot;</span><span class="p">)</span>

        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span>
                                   <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="n">FigureCanvas</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="VisibilityView.show_targets"><a class="viewcode-back" href="../source/pouet.html#main.VisibilityView.show_targets">[docs]</a>    <span class="k">def</span> <span class="nf">show_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">meteo</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            
            
        <span class="n">tel_lat</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">get_telescope_params</span><span class="p">()</span>
        
        <span class="c1">#self.finish_plot(tel_lat)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="VisibilityView.visbility_draw"><a class="viewcode-back" href="../source/pouet.html#main.VisibilityView.visbility_draw">[docs]</a>    <span class="k">def</span> <span class="nf">visbility_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs_time</span><span class="p">,</span> <span class="n">meteo</span><span class="p">,</span> <span class="n">airmass</span><span class="p">,</span> <span class="n">anglemoon</span><span class="p">,</span> <span class="n">check_wind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">ras</span><span class="p">,</span> <span class="n">decs</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">grid_points</span><span class="p">()</span>
        <span class="n">ra_g</span><span class="p">,</span> <span class="n">dec_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ras</span><span class="p">,</span> <span class="n">decs</span><span class="p">)</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_g</span><span class="p">)</span>
        <span class="n">vis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_g</span><span class="p">)</span>
        <span class="n">wind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ra_g</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">tel_lat</span><span class="p">,</span> <span class="n">tel_lon</span><span class="p">,</span> <span class="n">tel_elev</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">get_telescope_params</span><span class="p">()</span>

        <span class="n">observer</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Observer</span><span class="p">()</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">obs_time</span><span class="o">.</span><span class="n">iso</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">tel_lat</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">tel_lon</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">observer</span><span class="o">.</span><span class="n">elevation</span> <span class="o">=</span> <span class="n">tel_elev</span>

        <span class="n">moon</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">Moon</span><span class="p">()</span>
        <span class="n">moon</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>

        <span class="n">wpl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windWarnLevel&quot;</span><span class="p">))</span>
        <span class="n">wsl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="s2">&quot;windLimitLevel&quot;</span><span class="p">))</span>
        <span class="n">WD</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">winddirection</span>
        <span class="n">WS</span> <span class="o">=</span> <span class="n">meteo</span><span class="o">.</span><span class="n">windspeed</span>

        <span class="n">do_plot_contour</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ra</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ras</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">decs</span><span class="p">):</span>
                <span class="n">star</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">FixedBody</span><span class="p">()</span>
                <span class="n">star</span><span class="o">.</span><span class="n">_ra</span> <span class="o">=</span> <span class="n">ra</span>
                <span class="n">star</span><span class="o">.</span><span class="n">_dec</span> <span class="o">=</span> <span class="n">dec</span>
                <span class="n">star</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">elev2airmass</span><span class="p">(</span><span class="n">el</span><span class="o">=</span><span class="n">star</span><span class="o">.</span><span class="n">alt</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alt</span><span class="o">=</span><span class="n">observer</span><span class="o">.</span><span class="n">elevation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">airmass</span><span class="p">:</span>
                    <span class="n">vis</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">separation</span><span class="p">((</span><span class="n">moon</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">moon</span><span class="o">.</span><span class="n">dec</span><span class="p">),</span> <span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.</span>

                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">&gt;</span> <span class="n">anglemoon</span><span class="p">:</span>  <span class="c1"># Don&#39;t forget that the angular diam of the Moon is ~0.5 deg</span>
                        <span class="n">sep</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                        <span class="n">do_plot_contour</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sep</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                    <span class="k">if</span> <span class="n">check_wind</span> <span class="ow">and</span> <span class="n">WS</span> <span class="o">&gt;=</span> <span class="n">wsl</span><span class="p">:</span>
                        <span class="n">wind</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
                        <span class="n">cw</span> <span class="o">=</span> <span class="n">COLORLIMIT</span>
                        <span class="c1">#ct = &#39;WIND LIMIT REACHED&#39;</span>
                        <span class="c1">#cts = 35</span>
                    <span class="k">elif</span> <span class="n">check_wind</span> <span class="ow">and</span> <span class="n">WS</span> <span class="o">&gt;=</span> <span class="n">wpl</span><span class="p">:</span>
                        <span class="n">cw</span> <span class="o">=</span> <span class="n">COLORWARN</span>
                        <span class="c1">#ct = &#39;Pointing limit!&#39;</span>
                        <span class="c1">#cts = 20</span>
                        <span class="n">ws</span> <span class="o">=</span> <span class="n">ephem</span><span class="o">.</span><span class="n">separation</span><span class="p">((</span><span class="n">star</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">WD</span><span class="p">)),</span> <span class="p">(</span><span class="n">star</span><span class="o">.</span><span class="n">alt</span><span class="p">,</span> <span class="n">star</span><span class="o">.</span><span class="n">az</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">ws</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">:</span>
                            <span class="n">wind</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sep</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">vis</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="k">del</span> <span class="n">star</span>

        <span class="c1">#########################################################</span>

        <span class="n">ra_g</span> <span class="o">=</span> <span class="n">ra_g</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="n">dec_g</span> <span class="o">=</span> <span class="n">dec_g</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">anglemoon</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ra_g</span><span class="p">,</span> <span class="n">dec_g</span><span class="p">,</span> <span class="n">vis</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Greys&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">do_plot_contour</span><span class="p">:</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ra_g</span><span class="p">,</span> <span class="n">dec_g</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">CS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ra_g</span><span class="p">,</span> <span class="n">dec_g</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="p">)</span>

            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">anglemoon</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tt</span><span class="p">))</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">check_wind</span> <span class="ow">and</span> <span class="n">WS</span> <span class="o">&gt;</span> <span class="n">wpl</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;mycmap&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">),</span>
                                                                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cw</span><span class="p">)]</span>
                                                     <span class="p">)</span>

            <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ra_g</span><span class="p">,</span> <span class="n">dec_g</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">hatches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;//&#39;</span><span class="p">],</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="c1">#self.axis.annotate(ct, xy=(12, 75), rotation=0,</span>
            <span class="c1">#                   horizontalalignment=&#39;center&#39;, verticalalignment=&#39;center&#39;, color=cw, fontsize=cts)</span>

        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Right ascension&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Declination&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - Moon sep </span><span class="si">%d</span><span class="s2"> deg - max airmass </span><span class="si">%1.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obs_time</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> \
                                                                          <span class="n">anglemoon</span><span class="p">,</span> <span class="n">airmass</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">19</span><span class="p">))</span>
        

        
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_plot</span><span class="p">(</span><span class="n">tel_lat</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="VisibilityView.finish_plot"><a class="viewcode-back" href="../source/pouet.html#main.VisibilityView.finish_plot">[docs]</a>    <span class="k">def</span> <span class="nf">finish_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tel_lat</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tel_lat</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">lat</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lat</span> <span class="o">+</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="ObsModel"><a class="viewcode-back" href="../source/pouet.html#main.ObsModel">[docs]</a><span class="k">class</span> <span class="nc">ObsModel</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QAbstractTableModel</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QAbstractTableModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
<div class="viewcode-block" id="ObsModel.rowCount"><a class="viewcode-back" href="../source/pouet.html#main.ObsModel.rowCount">[docs]</a>    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mylist</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../source/pouet.html#main.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>  <span class="c1"># A new instance of QApplication</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">POUET</span><span class="p">()</span>                 <span class="c1"># We set the form to be our ExampleApp (design)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>                         <span class="c1"># Show the form</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>                         <span class="c1"># and execute the app</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Vivien Bonvin, Thibault Kuntzer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>